<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">
  <title>PhotoRec - Recover deleted files</title>
  <link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
  <link rel="stylesheet" href="css/main.css">
  <link href="atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>PhotoRec - Recover deleted files | Brainf+ck</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="PhotoRec - Recover deleted files" />
<meta name="author" content="Brainf+ck" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hacking - Cyber Security and Privacy" />
<meta property="og:description" content="Hacking - Cyber Security and Privacy" />
<link rel="canonical" href="https://brainfucksec.github.io/photorec-tutorial" />
<meta property="og:url" content="https://brainfucksec.github.io/photorec-tutorial" />
<meta property="og:site_name" content="Brainf+ck" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-08T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PhotoRec - Recover deleted files" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Brainf+ck"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://brainfucksec.github.io/photorec-tutorial"},"description":"Hacking - Cyber Security and Privacy","url":"https://brainfucksec.github.io/photorec-tutorial","@type":"BlogPosting","headline":"PhotoRec - Recover deleted files","dateModified":"2021-04-08T00:00:00+00:00","datePublished":"2021-04-08T00:00:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
</head>
<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="index.html">
    <h1>~/</h1>
    </a>
    <div class="header-links">
      <a href="posts.html"><h2 class="header-link">posts</h2></a>
<a href="whoami.html"><h2 class="header-link">whoami</h2></a>
<a href="dev.html"><h2 class="header-link">dev</h2></a>
<a href="contacts.html"><h2 class="header-link">contacts</h2></a>
<a href="atom.xml"><h2 class="header-link">rss</h2></a>
    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>PhotoRec - Recover deleted files</h2>
  <time datetime="2021-04-08T00:00:00+00:00" class="by-line">08 Apr 2021</time>
  <p><br /></p>
<h2 id="introduction">Introduction</h2>
<p>A tool that I prefer to recover deleted files or to analyze a memory in search of evidence is <a href="https://www.cgsecurity.org/wiki/PhotoRec">Photorec</a> by CGSecurity.</p>
<p>As explained on the program website:</p>
<p><em>PhotoRec is file data recovery software designed to recover lost files including video, documents and archives from hard disks, CD-ROMs, and lost pictures (thus the Photo Recovery name) from digital camera memory. PhotoRec ignores the file system and goes after the underlying data, so it will still work even if your media’s file system has been severely damaged or reformatted.
PhotoRec is a companion program to <a href="https://www.cgsecurity.org/wiki/TestDisk">TestDisk</a>, an application for recovering lost partitions on a wide variety of file systems and making non-bootable disks bootable again. For lost/deleted partitions or deleted files from a FAT or NTFS file system, try TestDisk first - it’s usually faster and TestDisk can retrieved the original file names.</em></p>
<p>For more information about the supported file types and how PhotoRec works you can consult the relevant paragraphs on the main page of the website:</p>
<p><a href="https://www.cgsecurity.org/wiki/PhotoRec">https://www.cgsecurity.org/wiki/PhotoRec</a></p>
<p>See: <strong>Known file formats</strong> and <strong>How PhotoRec works</strong>.</p>
<p>There is also an excellent <a href="testdisk.pdf">manual</a> about data recovery using TestDisk & PhotoRec and other tools.</p>
<p>PhotoRec can also be used to <a href="https://www.cgsecurity.org/wiki/Recover_data_from_an_iPhone">recover data from an iPhone</a> :) (Jailbroken).</p>
<h2 id="download">Download</h2>
<p>The program is available for different platforms, in GNU/Linux distros it can generally be installed through the preferred package manager, for example on Kali Linux I installed the package <code class="language-plaintext highlighter-rouge">testdisk</code>, while on Windows you can install and run the executable, also TestDisk and PhotoRec can be run as portable executables or from LiveCD.
For more information about program installation and running, consult the related page: <a href="https://www.cgsecurity.org/wiki/TestDisk_Download">TestDisk Download</a></p>
<h2 id="how-to">How to</h2>
<p>Now that we are familiar with this program, let’s see how to use it to recover files, for this demonstration I used a USB flash drive as the target memory. The program offers an interactive shell that is very easy to use, the steps necessary for the procedure are well explained on the website: <a href="https://www.cgsecurity.org/wiki/PhotoRec_Step_By_Step">PhotoRec Step by Step</a></p>
<p><strong>Note:</strong> The following steps are a demonstration of how PhotoRec works and therefore do not belong to a proper forensic analysis procedure.</p>
<p>In this demonstration I will delete the files present and then format the USB flash drive with the FAT32 filesystem, after which I will scan the memory for deleted files.</p>
<h2 id="memory-content">Memory content</h2>
<p>1 - Exploring the memory with a file manager we can see that inside there are some files of different formats:</p>
<p><img src="uploads/img/posts/photorec-tutorial/1-memory-content.png" alt="alt text" /></p>
<p>2 - I delete the files as we normally do, for example with the command <code class="language-plaintext highlighter-rouge">rm</code> on Linux:</p>
<p><img src="uploads/img/posts/photorec-tutorial/2-delete-files.png" alt="alt text" /></p>
<p>3 - Now the flash drive is “empty”:</p>
<p><img src="uploads/img/posts/photorec-tutorial/3-empty-directory.png" alt="alt text" /></p>
<p>4 - After formatting the flash drive, I check the filesystem:</p>
<p><img src="uploads/img/posts/photorec-tutorial/4-filesystem-list.png" alt="alt text" /></p>
<h2 id="analysis-and-recovery">Analysis and recovery</h2>
<p>1 - Start PhotoRec with the <code class="language-plaintext highlighter-rouge">/log</code> parameter to record the details of the procedure to a log file called <code class="language-plaintext highlighter-rouge">photorec.log</code>:</p>
<p><code class="language-plaintext highlighter-rouge">sudo photorec /log</code></p>
<p><img src="uploads/img/posts/photorec-tutorial/5-start-photorec.png" alt="alt text" /></p>
<p>2 - Select the disk to analyze, in my case it’s <code class="language-plaintext highlighter-rouge">/dev/sda</code>:</p>
<p><img src="uploads/img/posts/photorec-tutorial/6-select-disk.png" alt="alt text" /></p>
<p>3 - Select the partition, for this device, it’s the FAT32 partition labeled with the “P” letter:</p>
<p><img src="uploads/img/posts/photorec-tutorial/7-select-partition.png" alt="alt text" /></p>
<p>4 - Select the correct filesystem for the partition, generally PhotoRec recognizes the filesystem by itself, Unless it is an ext2/ext3/ext4 filesystem, choose <code class="language-plaintext highlighter-rouge">Other</code>:</p>
<p><img src="uploads/img/posts/photorec-tutorial/8-select-filesystem.png" alt="alt text" /></p>
<p>5 - Select the space where the files will be searched, if the option for unallocated space is selected, deleted files will be recovered:</p>
<p><img src="uploads/img/posts/photorec-tutorial/9-select-space.png" alt="alt text" /></p>
<p>6 - Select where the recovered files will be written, in this case I have created a folder to work in, you can use an external disk for this purpose (the correct method). Moving with the arrows, go to the favorite folder and press <code class="language-plaintext highlighter-rouge">c</code> to confirm:</p>
<p><img src="uploads/img/posts/photorec-tutorial/10-select-recover-folder.png" alt="alt text" /></p>
<p>7 - The program starts searching for files showing the progress:</p>
<p><img src="uploads/img/posts/photorec-tutorial/11-photorec-progress.png" alt="alt text" /></p>
<p>8 - Recovered files are saved to folders called <code class="language-plaintext highlighter-rouge">recup.dir</code>:</p>
<p><img src="uploads/img/posts/photorec-tutorial/12-recover-terminated.png" alt="alt text" /></p>
<h2 id="working-with-recovered-files">Working with recovered files</h2>
<p>1 - Previously deleted files have been recovered, named with the prefix “f” plus an identifying number, some also have the original name after the number:</p>
<p><img src="uploads/img/posts/photorec-tutorial/13-recovered-files.png" alt="alt text" /></p>
<p>2 - On the program’s website there is an excellent guide on how to work with recovered files: <a href="https://www.cgsecurity.org/wiki/After_Using_PhotoRec">After Using PhotoRec</a></p>
<p>In this case, I sort the files by extension with the python script shown in the guide:</p>
<p><img src="uploads/img/posts/photorec-tutorial/14-python-sort-script.png" alt="alt text" /></p>
<p>You need to create the folder in which to copy the sorted files and run the script with the “source” and “destination” parameters:</p>
<p><img src="uploads/img/posts/photorec-tutorial/15-sorted-files.png" alt="alt text" /></p>
<p>A more advanced script is available that gives you more options on file sorting: <a href="https://github.com/tfrdidi/sort-PhotorecRecoveredFiles">sort-PhotorecRecoveredFiles</a></p>
<p>3 - The script creates a folder for each type of file:</p>
<p><img src="uploads/img/posts/photorec-tutorial/16-filetypes.png" alt="alt text" /></p>
<h2 id="some-tips">Some tips</h2>
<ul>
  <li>
    <p>If you are looking for a specific file you can check the date/time attribute, PhotoRec uses time information (metadata) when available in the file header to set the file modification time:</p>
    <p><img src="uploads/img/posts/photorec-tutorial/17-datetime-sort.png" alt="alt text" /></p>
  </li>
  <li>
    <p>With .JPEG files you can use <a href="https://exiftool.org/">exiftool</a> to view the image metadata for additional information about the file:</p>
    <p><img src="uploads/img/posts/photorec-tutorial/18-exiftool-example.png" alt="alt text" /></p>
  </li>
  <li>
    <p>Thumbnails of the images found are saved as “t*.jpg”</p>
  </li>
  <li>
    <p>If you have chosen to keep corrupted files/file fragments, their filenames will beginning by the letter “b” (broken).</p>
  </li>
</ul>
<hr />
<p>by Brainfuck</p>
<p>Credits: <a href="https://www.cgsecurity.org/wiki/PhotoRec">PhotoRec</a></p>
</article>
      </section>
    </div>
  </div>
   <footer>
  <a href="https://creativecommons.org/licenses/by-nc/3.0/deed.en_US">
    <span>
        <b>Brainf+ck</b>
    </span>
    <span>© 2021</span>
  </a>
</footer>
  <!-- Google Analytics
  -->
</body>
</html>
